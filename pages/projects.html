<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Projects</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

    /* ===== Base (배경 고정 + 세로 스크롤 제거) ===== */
    :root { --bg-dark:#181818; --shadow:0 3px 20px #0006; --radius:20px; }
    html, body {
      margin:0; padding:0; width:100vw; height:100vh; overflow:hidden;
      background:#181818; background-size:cover; background-position:center; background-repeat:no-repeat;
    }
    body {
      font-family:'Roboto',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      color:#dcdcdc; line-height:1.6; display:flex; flex-direction:column;
    }

    /* ===== Layout ===== */
    .navbar-slot { flex:0 0 auto; }
    .page-main { flex:1 0 auto; display:flex; flex-direction:column; }
    .projects-panel {
      flex:1 0 auto; display:flex; align-items:center; justify-content:center;
      background:var(--bg-dark); overflow:hidden; /* translateX 애니메이션 전제 */
    }
    .projects-strip {
      display:flex; flex-direction:row; align-items:flex-start; justify-content:flex-start;
      gap:32px; width:100vw; margin-top:6vh; padding:0 0 24px 7vw;
      will-change:transform; transform:translateZ(0);
    }

    /* ===== Card ===== */
    .project-card {
      position:relative; flex:0 0 auto; cursor:pointer; overflow:hidden;
      width:calc(60vh / 1.4142); height:60vh; border-radius:var(--radius); box-shadow:var(--shadow);
      will-change:transform; transform:translateZ(0);
    }
    .project-card__img {
      width:100%; height:100%; display:block; object-fit:cover; border-radius:16px; transition:transform .3s;
    }
    .project-card:hover .project-card__img { transform:scale(1.03); }

    .project-card__overlay {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(24,24,24,.78); color:#fff; border-radius:inherit;
      opacity:0; transition:opacity .3s; z-index:2; text-align:center; padding:0 16px;
    }
    .project-card:focus .project-card__overlay,
    .project-card:hover .project-card__overlay { opacity:1; }
    .project-card__title {
      display:inline-block; font-size:1.4rem; font-weight:700; letter-spacing:1.5px; line-height:1.3;
      text-shadow:0 2px 8px #000a;
    }

    /* ===== Footer ===== */
    .footer-slot {
      position:fixed; left:0; right:0; bottom:0; width:100vw; min-height:56px;
      display:flex; align-items:center; justify-content:center; background:var(--bg-dark); z-index:100;
    }

    /* ===== Responsive ===== */
    @media (max-width:900px) {
      .projects-strip { gap:16px; padding-left:2vw; margin-top:4vw; }
      .project-card { width:calc(50vw - 32px); height:38vw; min-width:120px; max-width:90vw; min-height:120px; max-height:340px; border-radius:12px; }
      .project-card__img { border-radius:8px; }
    }

    /* Mobile fix: 스트립 전체 이동 유지 + 패널 80vw(비율 유지) */
    @media (max-width:600px) {
      .projects-strip {
        margin-top:12px; padding:0 2vw 16px 2vw; gap:10px;
        width:100vw; min-width:100vw; overflow:visible; white-space:normal;
      }
      .project-card {
        width:80vw; height:calc(80vw * 1.4142);
        min-width:180px; max-width:90vw; min-height:180px; max-height:540px;
        border-radius:14px; box-shadow:0 2px 12px #0004;
      }
      .project-card__img { border-radius:10px; }
      .project-card__overlay { font-size:1.05rem; border-radius:10px; padding:0 4px; }
      .footer-slot { min-height:48px; height:48px; }
    }

    /* 접근성: 터치 환경 hover 스케일 제거 */
    @media (hover:none) and (pointer:coarse) {
      .project-card:hover .project-card__img { transform:none; }
    }

    /* 모션 민감 사용자 배려 */
    @media (prefers-reduced-motion:reduce) {
      .project-card__img,
      .project-card__overlay,
      .projects-strip { transition:none !important; }
    }
  </style>
</head>

<body>
  <!-- Nav -->
  <div class="navbar-slot" id="navbar-placeholder"></div>
  <script src="../js/navbar-loader.js" defer></script>

  <main class="page-main">
    <section class="projects-panel">
      <div class="projects-strip" id="projectsStrip" aria-live="polite">
        <!-- Card 1 -->
        <article class="project-card" data-url="projects/project1.html" tabindex="0" aria-label="Cultural Center 2021">
          <div class="project-card__overlay">
            <span class="project-card__title">Cultural Center<br>2021</span>
          </div>
          <img class="project-card__img" src="../assets/img/projects/project1.png" alt="Cultural Center 썸네일">
        </article>

        <!-- Card 2 -->
        <article class="project-card" data-url="projects/project2.html" tabindex="0" aria-label="Urban Harmony">
          <div class="project-card__overlay">
            <span class="project-card__title">Urban Harmony</span>
          </div>
          <img class="project-card__img" src="../assets/img/projects/project2.jpg" alt="Urban Harmony 썸네일">
        </article>

        <!-- Card 3 -->
        <article class="project-card" data-url="projects/project3.html" tabindex="0" aria-label="Nature Blend">
          <div class="project-card__overlay">
            <span class="project-card__title">Nature Blend</span>
          </div>
          <img class="project-card__img" src="../assets/img/projects/project3.jpg" alt="Nature Blend 썸네일">
        </article>

        <!-- Card 4 -->
        <article class="project-card" data-url="projects/project4.html" tabindex="0" aria-label="Creative Office">
          <div class="project-card__overlay">
            <span class="project-card__title">Creative Office</span>
          </div>
          <img class="project-card__img" src="../assets/img/projects/project4.jpg" alt="Creative Office 썸네일">
        </article>

        <!-- Card 5 -->
        <article class="project-card" data-url="projects/project5.html" tabindex="0" aria-label="Minimal House">
          <div class="project-card__overlay">
            <span class="project-card__title">Minimal House</span>
          </div>
          <img class="project-card__img" src="../assets/img/projects/project5.jpg" alt="Minimal House 썸네일">
        </article>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <div class="footer-slot" id="footer-placeholder"></div>
  <script>
    fetch('../components/footer.html')
      .then(r => r.text())
      .then(html => { document.getElementById('footer-placeholder').innerHTML = html; });
  </script>

  <script>
    // ===== Slider Module (JS 로직 유지 + 정리) =====
    document.addEventListener('DOMContentLoaded', () => {
      const strip = document.getElementById('projectsStrip');
      let cards = Array.from(strip.querySelectorAll('.project-card'));

      // 1) 이미지 로딩 완료 후 시작
      const images = Array.from(strip.querySelectorAll('img'));
      const whenAllImagesReady = Promise.all(
        images.map(img => img.complete ? Promise.resolve() :
          new Promise(res => { img.addEventListener('load', res, { once:true }); img.addEventListener('error', res, { once:true }); }))
      );

      whenAllImagesReady.then(startSlider);

      function startSlider() {
        // 2) 무한 루프용 복제 (이미 복제되지 않았다면)
        if (cards.length && cards.length === strip.childElementCount) {
          strip.innerHTML += strip.innerHTML;
          cards = Array.from(strip.querySelectorAll('.project-card'));
        }

        // 3) 치수 계산
        let gap = parseInt(getComputedStyle(strip).gap || '0', 10);
        let unit = cards[0].offsetWidth + gap;
        let totalWidth = unit * cards.length;

        // 4) 애니메이션 상태
        let pos = 0;
        let speed = 0.8;
        let velocity = 0;
        let startX = null;
        let rafId = null;

        // 5) 렌더 루프
        const tick = () => {
          pos += speed + velocity;
          velocity *= 0.92;
          if (Math.abs(velocity) < 0.01) velocity = 0;

          if (pos < 0) pos += totalWidth / 2;
          if (pos >= totalWidth / 2) pos -= totalWidth / 2;

          strip.style.transform = `translateX(-${pos}px)`;
          rafId = requestAnimationFrame(tick);
        };
        rafId = requestAnimationFrame(tick);

        // 6) 입력: 휠/터치
        strip.addEventListener('wheel', (e) => {
          e.preventDefault();
          const delta = e.deltaX !== 0 ? e.deltaX : e.deltaY;
          velocity += delta * 0.15;
        }, { passive:false });

        strip.addEventListener('touchstart', (e) => {
          if (e.touches.length === 1) startX = e.touches[0].clientX;
        }, { passive:true });

        strip.addEventListener('touchmove', (e) => {
          if (startX !== null) {
            const diff = startX - e.touches[0].clientX;
            velocity += diff * 0.18;
            startX = e.touches[0].clientX;
          }
        }, { passive:true });

        strip.addEventListener('touchend', () => { startX = null; }, { passive:true });

        // 7) 클릭/키보드 접근성
        cards.forEach(card => {
          const url = card.getAttribute('data-url');
          if (!url) return;
          card.addEventListener('click', () => { window.location.href = url; });
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); window.location.href = url; }
          });
        });

        // 8) 리사이즈 대응: panel 폭/갭 다시 계산
        window.addEventListener('resize', () => {
          gap = parseInt(getComputedStyle(strip).gap || '0', 10);
          unit = cards[0].offsetWidth + gap;
          totalWidth = unit * cards.length;
        });
      }
    });
  </script>
</body>
</html>
